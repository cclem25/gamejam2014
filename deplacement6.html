<!doctype html>
<html>

<head>
	<meta charset="UTF-8">
	<title>Test d√©placement</title>
	<script src="./js/mesh.js"></script>	
	<script src="./js/scene.js"></script>	
	<script src="./js/game.js"></script>	
	<script src="./gamedata/js/gamejam.js"></script>	
	<script type="text/javascript">

var DEBUG = false;

var game = null;

init = function() {
	canvas = document.getElementById("cvs");
	canvas.addEventListener("click", cvsClick, false);
	context = canvas.getContext("2d");
	game = initGame(canvas);	
	game.setCurrentScene("map");	
	game.getCurrentScene().loadWithLocation(new Point(515, 508, 1));
	mainloop();
}


callbackWhenReady = function() {
	game.getCurrentScene().redraw();
}


var fps = 40;
// Main loop
mainloop = function() {
	
	if (game.getCurrentScene().nextPoint()) {
		// update display
		game.getCurrentScene().redraw();
	}

	// callback			
	setTimeout("requestAnimationFrame(mainloop)", 1000/fps);
}




cvsClick = function(event) {
	var newPoint = getPosition(event, game.getCurrentScene().getOFFSET_X(), game.getCurrentScene().getOFFSET_Y());
	game.getCurrentScene().click(newPoint);
}



/**
 *	Retrieves the clicked point from the mouse event
 *	@param	Event	event		The clicked event
 *	@param	int		OFFSET_X	X offset 
 *	@param	int		OFFSET_Y	Y offset
 *	@return	Point				The clicked point	
 */
getPosition = function(event, OFFSET_X, OFFSET_Y) {
	
	// gets the click coordinates
	if (event.x != undefined && event.y != undefined) {
		x = event.x;
		y = event.y;
	}	
	else { // Firefox method to get the position
		x = event.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;
		y = event.clientY + document.body.scrollTop + document.documentElement.scrollTop;
	}
	x -= canvas.offsetLeft + OFFSET_X; 
	y -= canvas.offsetTop + OFFSET_Y;
	 
	return new Point(x,y);
}
		</script>
</head>

<body onload="init()">

	<div style="width: 1004px; margin: 20px auto;">
		<canvas id="cvs" width="1000" height="560" style="border: solid 2px #000;">
		Votre navigateur ne supporte pas les canvas... Dommage.
		</canvas>
	</div>


</body>

</html>